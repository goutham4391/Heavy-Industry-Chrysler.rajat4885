var launchModeData=null,XbAppZipCodeChanger=new function(){var _modal,$=jQuery,_modalCloseBtn=document.querySelector(".xb-app-location-overlay .cllc-modal-button.model-close-btn"),_updateZipChanger=function(zipcode){var $zipCode=$("a[href='#xb-app-change-zipcode']");$zipCode.attr("aria-label","change zipcode "+zipcode),$zipCode.find("span").html(zipcode)},_clearErrors=function(){$(".xb-app-location-overlay-error-label").empty(),$(".xb-app-location-overlay-error").remove()},_updateZipCode=function(zipcode){cllc.context.set("zipCodeIsUserEntered",!0),cllc.context.set("zipcode",zipcode),_updateZipChanger(zipcode),_modal.close()},_checkInput=function(e){return 13===e.which||9===e.which||(8===e.which||0===e.which||!(e.which<48||57<e.which)||46===e.which||!(e.which<96||105<e.which))&&!(5<e.target.value.length)},_showZipCodeError=function(args){var errorString,errorValue="";switch((args=args||{}).type){case"geolocation":errorValue=cllc.geolocation.geolocationErrorMessage;break;default:errorValue=cllc.geolocation.invalidZipCodeErrorMessage}errorString='<div class="xb-app-location-overlay-error gcss-icon-warning">'+errorValue+"</div>",$(".xb-app-location-overlay-error-label").html(errorValue),$(this).after(errorString)},_openModal=function(e){if(e&&e.preventDefault(),!_modal){(_modal=new cllc.ui.modal).window.id="xb-app-location-overlay";var subBrand=function(){var subBrandMeta=document.querySelector("meta[name='subBrand']"),subBrand=null;return subBrandMeta&&subBrandMeta.getAttribute("content")&&(subBrand=subBrandMeta.getAttribute("content")),subBrand}();subBrand&&$(_modal.window).addClass("brand-"+subBrand),cllc.storage.local.get("zip_noclose")&&(_modal.closeOnMaskClick=!1,_modal.showButton=!1),_modal.onclose=function(){DATALAYER.linkTrack(!0,{lpos:"zipcode-overlay",linkType:"tool",lid:"close",vars:{prop1:cllc.context.get("vehicle"),eVar5:cllc.context.get("vehicle"),eVar59:cllc.context.get("zipcode")}})},_modalCloseBtn&&(_modalCloseBtn.focus(),_modalCloseBtn.onkeyup=function(e){27===e.keyCode&&_modal.close()})}var geolocationTemplate=cllc.geolocation.isCountryUSA?'<div class="xb-app-location-overlay-geolocate"><div class="or">OR</div><button class="gcss-button gcss-button-variable gcss-icon-location">Use Current Location</button></div>':"";_modal.open(String.format('<script src="/crossbrand_us/shopping-tools/shared/accessibility-es4.js"><\/script><div><strong class="zipTitle">Please enter your ZIP Code</strong><div class="divider-line">&nbsp;</div><p>Please enter a valid ZIP Code to customize the site based on your location.</p><form name="xb-app-location-overlay-zipcode"><fieldset><div class="gc-forms-textbox gc-forms-textbox-size-small"><label for="xb-app-location-overlay-zipcode-field" class="gcss-sr-only">Enter ZIP Code <span class="xb-app-location-overlay-error-label"></span></label><input autocomplete="off" name="xb-app-location-overlay-zipcode-field" id="xb-app-location-overlay-zipcode-field" type="text" maxlength="5" inputmode="numeric" pattern="[0-9]*" placeholder="Enter ZIP Code" /><button class="gcss-button gcss-button-variable" aria-label="submit">&nbsp;</button></div></fieldset></form>{0}</div>',window.navigator.geolocation?geolocationTemplate:""),{opener:e&&e.currentTarget?e.currentTarget:null}),$("#xb-app-location-overlay-zipcode-field").on("keyup change",function(){/^\d+$/.test($(this).val())||$(this).val($(this).val().replace(/\D/g,"")),5<$(this).val().length&&$(this).val($(this).val().substring(0,5))}),$("#xb-app-location-overlay-zipcode-field").keypress(function(e){return _checkInput(e)}),$("#xb-app-location-overlay-zipcode-field").keydown(function(e){return _checkInput(e)}),_modal.closeOnMaskClick=!0,_modal.showButton=!0,cllc.storage.local.remove("zip_noclose")},_onZipFormSubmit=function(e){e.preventDefault(),_clearErrors();var zipcode=$("[name='xb-app-location-overlay-zipcode-field']",this).val();cllc.utils.isValidZipCodeShort(zipcode)?_updateZipCode(zipcode):(_showZipCodeError.call(this,{type:"zipcode"}),$("#xb-app-location-overlay-zipcode-field").focus()),DATALAYER.linkTrack(!0,{lpos:"zipcode-overlay",linkType:"tool",lid:"submit_zip",vars:{prop1:cllc.context.get("vehicle"),eVar5:cllc.context.get("vehicle"),eVar59:cllc.context.get("zipcode")}})},_onGeoLocateClick=function(e){var $zipForm=$("form[name='xb-app-location-overlay-zipcode']:first"),doLinkTrack=function(zipcode){var linkTrackArgs={lpos:"zipcode-overlay",lid:"use_current_location",vars:{prop1:cllc.context.get("vehicle"),eVar5:cllc.context.get("vehicle")}};zipcode&&(linkTrackArgs.vars.eVar59=zipcode),DATALAYER.linkTrack(!0,linkTrackArgs)};e.preventDefault(),_clearErrors(),cllc.geolocation.getZipCodeFromCurrentLocation().then(function(result){return _updateZipCode(result),doLinkTrack(result),null}).catch(function(){return _showZipCodeError.call($zipForm,{type:"geolocation"}),doLinkTrack(),null})},initializedContext=function(a,b){cllc.request.cookies&&cllc.request.cookies.zipcode&&cllc.request.cookies.zipcode.value&&"undefined"!==cllc.context.get("zipcode")&&cllc.context.set("zipcode",cllc.request.cookies.zipcode.value);var hasFADApp=$('[data-component="FADApp"]').length;"undefined"!==cllc.context.get("zipcode")||hasFADApp||_openModal(),b&&(cllc.context.get("zipcode")||cllc.request.queryString.print?_updateZipChanger(cllc.context.get("zipcode")):hasFADApp||(cllc.storage.local.set("zip_noclose","true"),_openModal()))};(function(){$(document).on("submit","form[name='xb-app-location-overlay-zipcode']",_onZipFormSubmit),$(document).on("click",".xb-app-location-overlay-geolocate button",_onGeoLocateClick),$(document).on("click","a[href='#xb-app-change-zipcode']",_openModal),cllc.context.get("cllc.contextInitialized")?initializedContext(0,!0):cllc.context.addListenerOnce("cllc.contextInitialized",initializedContext),cllc.context.addListener("zipcode",function(a,b){_updateZipChanger(b)})}).call(this)};window.sdp&&(cllc.context.addListener("year",function(oldVal,newVal){oldVal!=newVal&&(sdp.context.set("year",newVal),DATALAYER.set({year:newVal}))}),cllc.context.addListener("vehicle",function(oldVal,newVal){var vehicle="",modelCode="",modelYearCode="";modelCode="";oldVal!=newVal&&(vehicle=newVal,cllc.context.get("year")&&cllc.context.get("vehicle")&&(modelYearCode=Vehicles.getModelYearCode(cllc.context.get()))&&DATALAYER.getVehicleModel&&(modelCode=modelYearCode.substr(-2),sdp.context.set("modelCode",modelCode),vehicle=DATALAYER.getVehicleModel(modelCode)),sdp.context.set("vehicle",newVal),DATALAYER.set({vehicle:vehicle}))}),cllc.context.addListener("trim",function(oldVal,newVal){oldVal!=newVal&&(sdp.context.set("trim",newVal),DATALAYER.set({trim:newVal}))}),cllc.context.addListener("zipcode",function(oldVal,newVal){oldVal!=newVal&&(sdp.context.set("zipcode",newVal),DATALAYER.set({zipcode:newVal}))}),cllc.context.addListener("model",function(oldVal,newVal){var obj={};oldVal!=newVal&&(obj=cllc.context.get(),sdp.context.set("model",newVal),sdp.context.set("ccode",Vehicles.getCcode(obj)),sdp.context.set("llp",Vehicles.getLLP(obj)),DATALAYER.set({model:newVal}))}));var buildCompare={add:function(data){window.Context&&(data.timestamp=(new Date).getTime(),Context.set("addCompareBMO",data))},remove:function(data){window.Context&&(data.timestamp=(new Date).getTime(),Context.set("removeCompareBMO",data))},isAdded:function(ccode,llp,conf){var storedBuilds=this._getAllFromStore();return 0<jQuery.grep(storedBuilds,function(eachBuild){return eachBuild.code===ccode&&eachBuild.llp===llp&&eachBuild.conf===conf}).length},getAllBuilds:function(){var storedBuilds=this._getAllFromStore(),allBuilds=[];return jQuery.map(storedBuilds,function(eachBuild){allBuilds.push({conf:eachBuild.conf,modelYearCode:eachBuild.myc,ccode:eachBuild.code,llp:eachBuild.llp})}),allBuilds},_getAllFromStore:function(){var builds=[],store=localStorage&&localStorage.LocalStorageStore,pageModelCode=this._getPageModelCode();if(store)try{var configCompare=JSON.parse(JSON.parse(store)).LocalStorageStore.configCompare;configCompare&&configCompare.modelCode&&configCompare.modelCode===pageModelCode&&(builds=JSON.parse(JSON.parse(store)).LocalStorageStore.configCompare.models),builds||(builds=[])}catch(e){}return builds},_getPageModelCode:function(){if(this.pageModelCode)return this.pageModelCode;var hashValue=window.location.hash,mycMatch=hashValue&&hashValue.match(/\/vehicle\/(.*?)(?=\/|$)/i),pageMyc="",pageModelCode="";return mycMatch&&(pageModelCode=(pageMyc=mycMatch[1])?pageMyc.substr(0,3)+pageMyc.substr(7,2):""),this.pageModelCode=pageModelCode}},processLaunchModeData=function(res){var noPricingArray=[],noInventoryArray=[];return!(!res||!res.models)&&(res.models.forEach(function(item){item.mode.forEach(function(type){"NO_PRICE"===type.typeCode&&noPricingArray.push({ccode:item.ccode,llp:item.llp}),"NO_INVENTORY"===type.typeCode&&noInventoryArray.push({ccode:item.ccode,llp:item.llp})})}),{noPricingArray:noPricingArray,noInventoryArray:noInventoryArray})},shoppingTools={lMSuccessQueue:[],lMErrorQueue:[],getVehicleSelectorMYC:function(){var modelYearCode,urlSplitValues=window.location.pathname.split(".");if(2<urlSplitValues.length&&""!==urlSplitValues[1])try{modelYearCode=Vehicles.getModelYearCode({year:urlSplitValues[2],vehicle:urlSplitValues[1]})}catch(err){modelYearCode=""}return modelYearCode||""},getlaunchMode:function(successCallBack,errorCallBack){if(launchModeData)successCallBack(launchModeData);else if("undefined"==typeof cllc||0!==this.lMSuccessQueue.length&&0!==this.lMErrorQueue.length)0<shoppingTools.lMSuccessQueue.length||0<shoppingTools.lMSuccessQueue.lMErrorQueue?(shoppingTools.lMSuccessQueue.push(successCallBack),shoppingTools.lMErrorQueue.push(errorCallBack)):(successCallBack(),errorCallBack());else{var request=new cllc.request.ajax("/hostd/api/launch-mode/modes");request.responseType="json",shoppingTools.lMSuccessQueue.push(successCallBack),shoppingTools.lMErrorQueue.push(errorCallBack),request.onsuccess=function(response){var result=processLaunchModeData(response);result?(launchModeData=result,shoppingTools.lMSuccessQueue.length&&(shoppingTools.lMSuccessQueue.forEach(function(fn){fn(result)}),shoppingTools.lMSuccessQueue=[])):shoppingTools.lMSuccessQueue.length&&shoppingTools.lMSuccessQueue.forEach(function(fn){fn()})},request.onerror=function(){shoppingTools.lMErrorQueue.length&&(shoppingTools.lMErrorQueue.forEach(function(fn){"function"==typeof fn&&fn()}),shoppingTools.lMErrorQueue=[])},request.send()}}};