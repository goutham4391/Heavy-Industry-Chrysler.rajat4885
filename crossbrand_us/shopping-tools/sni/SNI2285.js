var SNI=function($){"";"use strict";var _defaultModelYearCodeContext=void 0,_defaultVehicleContext=void 0,page=$("div[data-page-template]").attr("data-page-template"),_config={defaultRadius:"fiatusa"===cllc.config.brand?50:25,dealerURL:"/bdlws/MDLSDealerLocator",isDetails:"sni-vehicle-details"===page},_params=cllc.request.queryString.toJSON(),_request=function(url){cllc.request.ajax.call(this,url)};_request.prototype=Object.create(cllc.request.ajax.prototype);var _dealers={cache:[],dealerCallback:[],allDealersCallback:[],getRadius:function(){return cllc.context.get("radius")||cllc.request.queryString.radius||_config.defaultRadius},getBrandFilter:function(){var brand;switch(cllc.config.brand){case"fiatusa":brand="isFiat";break;case"ramtrucks":brand="isRamTrucks";break;default:brand="is"+cllc.config.brand.charAt(0).toUpperCase()+cllc.config.brand.substr(1)}return brand},getDealerHours:function(dealerCode){if(_dealers.cache.dealer&&_dealers.cache.dealer.length&&_dealers.cache.dealerHours&&_dealers.cache.dealerHours.length)for(var i=0;i<_dealers.cache.dealerHours.length;i++)if(_dealers.cache.dealerHours[i][0].dealerCode==dealerCode)return _dealers.cache.dealerHours[i];return{}},getDealerByDealerCode:function(dealerCode){var dealer={};if(_dealers.cache.dealer&&_dealers.cache.dealer.length)for(var i=0;i<_dealers.cache.dealer.length;i++)if(_dealers.cache.dealer[i].dealerCode==dealerCode)return dealer=_dealers.cache.dealer[i],_config.isDetails&&(dealer.dealerHours=_dealers.getDealerHours(dealerCode)),""!==dealer.website&&-1===dealer.website.indexOf("http")&&(dealer.website="http://"+dealer.website),dealer;return{}},getCachedDealers:function(){return _dealers.cache.dealer},getDealers:function(callback){_dealers.cache.dealer&&_dealers.cache.dealer.length?callback(_dealers.getCachedDealers()):_dealers.allDealersCallback.push({callback:callback})},getDealer:function(dealerCode,callback){_dealers.cache.dealer&&_dealers.cache.dealer.length?callback(_dealers.getDealerByDealerCode(dealerCode)):_dealers.dealerCallback.push({callback:callback,dealerCode:dealerCode})},getDealerData:function(){var brandCode=Vehicles.division;"T"==brandCode&&(brandCode="R");var request,params="zipCode="+cllc.context.get("zipcode")+"&func=SALES&radius="+_dealers.getRadius()+"&brandCode="+brandCode+"&resultsPerPage=999",fnOnRequestComplete=function(data){var dealer;data&&(_dealers.cache=data);for(var i=0;i<_dealers.dealerCallback.length;i++)dealer=_dealers.getDealerByDealerCode(_dealers.dealerCallback[i].dealerCode),_dealers.dealerCallback[i].callback(dealer);for(var j=0;j<_dealers.allDealersCallback.length;j++)_dealers.allDealersCallback[j].callback(_dealers.getCachedDealers());_dealers.dealerCallback=[],_dealers.allDealersCallback=[]},url=_config.dealerURL+"?"+params;cllc.context.get("zipcode")&&((request=new _request(url)).responseType="json",request.onsuccess=fnOnRequestComplete,request.onerror=function(error){fnOnRequestComplete(null)},request.send())}},_session={data:{modelYearCode:(_params.modelYearCode||shoppingTools.getVehicleSelectorMYC()).replace(/^C/,"I"),vehicles:{},filters:{},searchCriteria:{}},setVehicle:function(vin,vehicle){_session.data.vehicles[vin]=vehicle,_session.setSNISession()},getVehicle:function(vin){return _session.data.vehicles[vin]},setVehicleMetaData:function(metadata){_session.data.metadata=metadata,_session.setSNISession()},getVehicleMetaData:function(){return _session.data.metadata},setFilterValues:function(filters){_session.data.filters=filters,_session.setSNISession()},getFilterValues:function(){return _session.data.filters},setSearchCriteria:function(criteria){_session.data.searchCriteria=criteria,_session.setSNISession()},getSearchCriteria:function(){return _session.data.searchCriteria},remove:function(){cllc.storage.local.remove("SNI")},setSNISession:function(){cllc.storage.local.set("SNI",_session.data)},init:function(){var sniSessionObj=cllc.storage.local.get("SNI");sniSessionObj&&(sniSessionObj.modelYearCode==_params.modelYearCode?_session.data=cllc.storage.local.get("SNI"):_session.remove())}},_setContext=function(){var dealerRadius,modelCode,modelYearCode,vehicleFamilyFromMYC,vehicleYearFromMYC,metaElement,defaultModelYearCodeContext=(void 0!==_defaultModelYearCodeContext||(metaElement=document.querySelector("meta[name='defaultModelYearCode']"))&&metaElement.getAttribute("content")&&(_defaultModelYearCodeContext=metaElement.getAttribute("content")),_defaultModelYearCodeContext||""),defaultModelYearContext=defaultModelYearCodeContext.substring(3,7),defaultVehicleContext=function(){var metaElement;return void 0!==_defaultVehicleContext||(metaElement=document.querySelector("meta[name='vehicle']"))&&metaElement.getAttribute("content")&&(_defaultVehicleContext=metaElement.getAttribute("content")),_defaultVehicleContext}()||"";if(!_params.modelYearCode&&!_params.ccode&&(modelYearCode=shoppingTools.getVehicleSelectorMYC(),_params.modelYearCode=modelYearCode,!_params.modelYearCode)){if(!defaultModelYearCodeContext)return void location.replace("/vehicle-selector.sni.html");_params.modelYearCode=defaultModelYearCodeContext,vehicleFamilyFromMYC=defaultVehicleContext,vehicleYearFromMYC=defaultModelYearContext}if(_params.modelYearCode)_params.modelYearCode=_params.modelYearCode.replace(/^C/,"I"),modelYearCode="C"+_params.modelYearCode.substring(1);else if(_params.ccode)modelYearCode="C"+_params.ccode.substring(0,9).substr(1),_params.modelYearCode=modelYearCode.replace(/^C/,"I");else if(_config.isDetails&&!_session.getVehicle(_params.vin))return void location.replace("../?modelYearCode="+_params.modelYearCode);modelYearCode&&(modelCode=modelYearCode.substr(-2)),vehicleFamilyFromMYC=vehicleFamilyFromMYC||Vehicles.getFamilyFromMYC(modelYearCode),(vehicleYearFromMYC=vehicleYearFromMYC||Vehicles.getYearFromMYC(modelYearCode))&&vehicleFamilyFromMYC?(dealerRadius=_dealers.getRadius(),cllc.context.set("year",vehicleYearFromMYC),cllc.context.set("vehicle",vehicleFamilyFromMYC),cllc.context.set("radius",dealerRadius),sdp.context.set("year",vehicleYearFromMYC),sdp.context.set("vehicle",vehicleFamilyFromMYC),sdp.context.set("modelCode",modelCode),DATALAYER.set({year:vehicleYearFromMYC,vehicle:DATALAYER.getVehicleModel(modelCode),pageType:"shopping-tools"}),cllc.context.set("myc_i",_params.modelYearCode)):location.replace("/vehicle-selector.sni.html")};return _session.init(),_setContext(),_dealers.getDealerData(),cllc.context.addListener("zipcode",function(oldVal,newVal){oldVal!=newVal&&newVal&&(_dealers.cache=[],_dealers.getDealerData())}),cllc.context.addListener("radius",function(oldVal,newVal){oldVal!=newVal&&newVal&&(_dealers.cache=[],_dealers.getDealerData())}),{page:page,request:_request,getDealer:_dealers.getDealer,getDealers:_dealers.getDealers,getSelectedVehicle:_session.getVehicle,setSelectedVehicle:_session.setVehicle,setMetaData:_session.setVehicleMetaData,getMetaData:_session.getVehicleMetaData,setFilterValues:_session.setFilterValues,getFilterValues:_session.getFilterValues,setSearchCriteria:_session.setSearchCriteria,getSearchCriteria:_session.getSearchCriteria,activeTab:function(){var getWdgt=$('section[data-wdgt="vehicle-specs"]');return $.trim(getWdgt.find(".tab-links li.active").text())},params:_params}}(jQuery);