var SNI=SNI||{};SNI.events=function($){"";"use strict";var _filterModal,_isGreaterThan767=!0,fnMatchMedia=window.matchMedia;fnMatchMedia&&fnMatchMedia("(max-width: 767px)").matches&&(_isGreaterThan767=!1);var page,onCVDDataInitialized,$filterContainer=$(".filter-container"),$filterContainerWdgtContainer=$filterContainer.find(".wdgt-container"),_currentScrollYPosition=0,_fnGetElementBoundingClientRect=function(selector,property){var $element,element,$window=$(window),windowHeight=$window.height(),boundingClientRect={top:0,right:0,bottom:0,left:0,width:0,outerWidth:0,height:0,outerHeight:0,offsetTop:0,offsetBottom:0,offsetLeft:0,position:"",visibleHeight:0,element:void 0,$element:void 0,intersectsWithRect:function(){return!1},isInView:function(){}};return $element=selector&&selector.jquery?selector:$(selector),property=2===arguments.length&&boundingClientRect.hasOwnProperty(property)?property:void 0,$element.length&&((boundingClientRect=(element=$element.get(0)).getBoundingClientRect()).outerHeight=$element.outerHeight(!0),boundingClientRect.outerWidth=$element.outerWidth(!0),boundingClientRect.offsetTop=$element.offset().top,boundingClientRect.offsetBottom=boundingClientRect.offsetTop+boundingClientRect.outerHeight,boundingClientRect.offsetLeft=element.offsetLeft,boundingClientRect.position=$element.css("position"),boundingClientRect.$element=$element,boundingClientRect.element=element,boundingClientRect.visibleHeight=Math.max(0,0<boundingClientRect.top?Math.min(boundingClientRect.outerHeight,windowHeight-boundingClientRect.top):boundingClientRect.bottom<windowHeight?boundingClientRect.bottom:windowHeight),boundingClientRect.intersectsWithRect=function(r){return this.left<=r.right&&r.left<=this.right&&this.top<=r.bottom&&r.top<=this.bottom},boundingClientRect.isInView=function(){var thisBoundTop,thisBoundRight,thisBoundBottom,inViewHorizontal,inViewVertical,viewport={top:$window.scrollTop(),left:$window.scrollLeft(),width:$window.width(),height:windowHeight};return viewport.bottom=viewport.top+viewport.height,viewport.right=viewport.left+viewport.width,!(!this.outerWidth||!this.outerHeight)&&(thisBoundTop=this.top,thisBoundRight=this.left+this.outerWidth,"fixed"===this.position&&(thisBoundTop=this.offsetTop),thisBoundBottom=thisBoundTop+this.outerHeight,inViewHorizontal=0<=thisBoundRight&&this.left<=viewport.width&&this.left<viewport.right,inViewVertical=0<thisBoundBottom&&thisBoundTop<viewport.bottom&&0<this.visibleHeight,inViewHorizontal&&inViewVertical)},boundingClientRect.toString=function(){var thisKeyArr=Object.keys(this),protoKeyArr=Object.keys(this.constructor.prototype);return Array.prototype.push.apply(thisKeyArr,protoKeyArr),thisKeyArr.filter(function(q){var thisValue;return!/^(\$)?element$/i.test(q)&&(thisValue=this[q],"isInView"===q||"function"!=typeof thisValue)},this).map(function(q){var thisValue=this[q];return"isInView"===q&&(thisValue=thisValue.call(this)),q+":"+thisValue},this).join("|")}),property?boundingClientRect[property]:boundingClientRect},_fnSetElementBoundingClientRect=function($element,boundingRect){return $element=$element&&$element.jquery?$element:$element instanceof HTMLElement?$($element):null,(boundingRect="object"==typeof boundingRect?boundingRect:void 0)&&$element&&$element.length?$element.css(boundingRect):$element},getSubBrand=function(){var subBrandMeta=document.querySelector("meta[name='subBrand']"),subBrand=null;return subBrandMeta&&subBrandMeta.getAttribute("content")&&(subBrand=subBrandMeta.getAttribute("content")),subBrand},_peModal=function(event){var peData,ccode,trim,offerState,overlayOptions,offerStateCookie,subBrand=getSubBrand(),contextVehicle=cllc.context.get("vehicle");event.preventDefault(),ccode=(peData=$(this).data()).ccode,trim=Vehicles.getTrimFromCcode(ccode);var trackObj={lid:peData.lid,lpos:peData.lpos,linkType:"cta",vars:{eVar5:contextVehicle+":"+trim,prop1:contextVehicle+":"+trim}};peData&&peData.statuscode&&(trackObj.vars.eVar102=peData.statuscode),DATALAYER.linkTrack(this,trackObj),offerState={destination:peData.destination,msrp:peData.msrp,selectedOptions:peData.options},overlayOptions={ccode:ccode,llp:peData.llp,calling_app:"sni",offerState:offerState,vin:peData.vin,dealerid:peData.dealerid,selectorUrl:!0,subBrand:subBrand},(offerStateCookie=new cllc.httpCookie("offerState")).values=offerState,cllc.request.cookies.add(offerStateCookie),overlay.build("pe",overlayOptions)},_gaqModal=function(event){var overlayOptions,$this=$(this);event.preventDefault(),overlayOptions={calling_app:"sni",ccode:$this.attr("data-ccode").replace(/^I/,"C"),llp:$this.attr("data-llp"),vin:$this.attr("data-vin"),dealer_id:$this.attr("data-dealerCode"),vehicle_image:$this.attr("data-vehImage"),dealer_name:$this.attr("data-dealerName"),dealer_address:$this.attr("data-dealerAddress"),dealer_city:$this.attr("data-city"),dealer_state:$this.attr("data-dealerState"),dealer_zip:$this.attr("data-dealerZip"),dealer_phone:$this.attr("data-dealerPhone"),dealer_url:$this.attr("data-dealerUrl")},overlay.build("gaq",overlayOptions)},_backToResults=function(event){var $this=$(this),contextVehicle=cllc.context.get("vehicle");event.preventDefault(),DATALAYER.linkTrack(this,{lpos:$this.data("lpos"),lid:$this.data("lid"),linkType:"tool",vars:{eVar5:contextVehicle,prop1:contextVehicle}}),window.history.back()},_fixFilterPositionOptionsDefault=function(){var _positionType={name:"positionType",value:void 0},_fixFilterPositionOptionsDefault={$fixToElement:$("header.xb-app-header"),heightOffset:function(){var returnValue,$fixedHeaderNavigationRect,$fixToElementBoundingClientRect=_fnGetElementBoundingClientRect(this.$fixToElement),$fixedHeaderNavigation=$("header.global-nav *:visible").filter(function(){return"fixed"===$(this).css("position")&&$(this).height()});return $fixedHeaderNavigation.length&&($fixedHeaderNavigationRect=_fnGetElementBoundingClientRect($fixedHeaderNavigation),$fixToElementBoundingClientRect.visibleHeight-=$fixedHeaderNavigationRect.visibleHeight),(returnValue=$fixToElementBoundingClientRect.isInView()?$fixToElementBoundingClientRect.offsetTop:$fixedHeaderNavigation.height()||0)&&(returnValue+=20),returnValue},fixedTop:function(){var $fixedHeaderNavigationRect,$fixToElementBoundingClientRect=_fnGetElementBoundingClientRect(this.$fixToElement),$fixedHeaderNavigation=$("header.global-nav *:visible").filter(function(){return"fixed"===$(this).css("position")&&$(this).height()}),offsetValue=$fixToElementBoundingClientRect.offsetTop<$fixToElementBoundingClientRect.outerHeight?$fixToElementBoundingClientRect.offsetTop:0;return $fixedHeaderNavigation.length&&($fixedHeaderNavigationRect=_fnGetElementBoundingClientRect($fixedHeaderNavigation),$fixToElementBoundingClientRect.visibleHeight-=$fixedHeaderNavigationRect.visibleHeight),window.scrollY-(window.outerHeight-window.innerHeight)-($fixToElementBoundingClientRect.outerHeight-$fixedHeaderNavigation.outerHeight())+offsetValue},fixedTopPositionY:function(){var $fixToElementBoundingClientRect=_fnGetElementBoundingClientRect(this.$fixToElement),$fixedHeaderNavigation=$("header.global-nav *:visible").filter(function(){return"fixed"===$(this).css("position")&&$(this).height()}),$fixedHeaderNavigationRectVisibleHeight=0;return $fixedHeaderNavigation.length&&($fixedHeaderNavigationRectVisibleHeight=_fnGetElementBoundingClientRect($fixedHeaderNavigation).visibleHeight,$fixToElementBoundingClientRect.visibleHeight-=$fixedHeaderNavigationRectVisibleHeight),$fixedHeaderNavigationRectVisibleHeight+$(document).scrollTop()},fnReset:function(){$filterContainer.css({position:"static"}),$filterContainerWdgtContainer.removeClass("fixed absolute-bottom absolute-top").css({width:"",height:"auto",top:"",left:""})},onPositionChange:function(e){this.fnReset(e)}};return Object.defineProperty(_fixFilterPositionOptionsDefault,_positionType.name,{get:function(){return _positionType.value},set:function(value){var hasChanged=value!==_positionType.value,changedEventArgs={previous:_positionType.value,current:value};_positionType.value=value,hasChanged&&this.onPositionChange.call(this,changedEventArgs)},configurable:!0,enumerable:!1}),_fixFilterPositionOptionsDefault}(),_fixFilterPosition=function(options){var filterContainerWdgtContainerWidth,fixedWidth,fixedHeight,fixedTop,fixedTopPositionY,fixedTopPositionX,heightOffset,$fixToElement,shouldPositionBottom,shouldFixTop,resultsRect,filterRect,fixToElementRect,filterContainerRect,fnReset,case1,case2a,case2b,case2c,$resultsContainer=$(".results-container"),$window=$(window),windowHeight=$window.height(),windowScrollTop=$window.scrollTop();fixedWidth=(options=options&&"object"==typeof options?options:{fixedWidth:0,fixedHeight:0}).fixedWidth||0,fixedHeight=options.fixedHeight||0,fixedTop=options.fixedTop||0,fixedTopPositionY=options.fixedTopPositionY||0,fixedTopPositionX=function(rect){var returnValue;try{returnValue=rect.offsetLeft||rect.element.offsetParent.offsetLeft}catch(e){returnValue=0}return returnValue},heightOffset=options.heightOffset||0,$fixToElement=options.$fixToElement||$(""),fnReset=options.fnReset,"function"==typeof fixedTop&&(fixedTop=options.fixedTop()),"function"==typeof fixedTopPositionY&&(fixedTopPositionY=options.fixedTopPositionY()),"function"==typeof heightOffset&&(heightOffset=options.heightOffset()),fixedTop=Number(fixedTop),fixedTop=isNaN(fixedTop)?0:fixedTop,fixedTopPositionY=Number(fixedTopPositionY),fixedTopPositionY=isNaN(fixedTopPositionY)?0:fixedTopPositionY,heightOffset=Number(heightOffset),heightOffset=isNaN(heightOffset)?0:heightOffset,resultsRect=_fnGetElementBoundingClientRect($resultsContainer),filterRect=_fnGetElementBoundingClientRect($filterContainerWdgtContainer),fixToElementRect=_fnGetElementBoundingClientRect($fixToElement),case1=10<Math.abs(resultsRect.height-filterRect.height),case2a=resultsRect.visibleHeight<=0,case2b=filterRect.offsetBottom>=resultsRect.offsetBottom&&resultsRect.bottom<=resultsRect.visibleHeight,case2c="fixed"!==filterRect.position&&resultsRect.bottom<=resultsRect.visibleHeight,shouldPositionBottom=case1&&(case2a||case2b||case2c),shouldFixTop=function(){var case1=resultsRect.height!==filterRect.height,case2=!shouldPositionBottom,case3a="absolute"!==fixToElementRect.position&&fixToElementRect.offsetBottom>=filterRect.top,case3b=resultsRect.bottom>=resultsRect.visibleHeight,case4=resultsRect.outerHeight>windowHeight&&heightOffset<=windowScrollTop,case5=fixToElementRect.bottom-fixedTop<=0,case6=$(".results-container .results ").height()>filterRect.height;return case1&&case2&&(case3a||case3b)&&case4&&case5&&case6}(),options.positionType=shouldPositionBottom?"bottom":shouldFixTop?"fixedtop":void 0,_isGreaterThan767?shouldPositionBottom?(filterContainerWdgtContainerWidth=fixedWidth||$filterContainerWdgtContainer.width(),$filterContainer.css({position:"relative"}),$filterContainerWdgtContainer.addClass("absolute-bottom").css("width",filterContainerWdgtContainerWidth)):shouldFixTop&&(filterContainerWdgtContainerWidth=fixedWidth||$filterContainerWdgtContainer.width(),fixedHeight=fixedHeight||windowHeight,filterContainerRect=_fnGetElementBoundingClientRect($filterContainer),0<heightOffset&&(fixedHeight-=heightOffset),_fnSetElementBoundingClientRect($filterContainerWdgtContainer.addClass("absolute-top"),{width:filterContainerWdgtContainerWidth,height:fixedHeight||windowHeight,top:fixedTopPositionY,left:fixedTopPositionX(filterContainerRect)})):fnReset()},_showMobileFilterModal=function(){var $mobileFilterModal,subBrand=getSubBrand(),noOverflowClassName=subBrand?"no-overflow-y brand-"+subBrand:"no-overflow-y",$body=$("body"),getMatchType=$(".results-tabs li.active").attr("data-matchtype"),contextVehicle=cllc.context.get("vehicle");_currentScrollYPosition=window.pageYOffset,getMatchType="X"===getMatchType?"exact-matches":"partial-matches",_filterModal||($filterContainerWdgtContainer.data("original-parent",$filterContainerWdgtContainer.parent()),_filterModal=new cllc.ui.modal,subBrand?$(_filterModal.window).addClass("brand-"+subBrand):$(_filterModal.window).removeClass("brand-"+subBrand),_filterModal.destroyOnClose=!1,_filterModal.window.className+=" wdgt-inventory-filter-overlay",_filterModal.showButton=!1,_filterModal.position.y=0,_filterModal.onclose=function(){$body.removeClass(noOverflowClassName),$filterContainerWdgtContainer.appendTo($filterContainerWdgtContainer.data("original-parent")),$filterContainerWdgtContainer.removeClass("fixed"),window.scrollTo(0,_currentScrollYPosition),_fixFilterPosition(_fixFilterPositionOptionsDefault)}),$filterContainerWdgtContainer.removeClass("fixed absolute-bottom").css({width:"",height:"",top:""}),$body.addClass(noOverflowClassName),_fnSetElementBoundingClientRect($filterContainerWdgtContainer,{width:"100%"}),_filterModal.open($filterContainerWdgtContainer.get(0)),$mobileFilterModal=$(".wdgt-inventory-filter-overlay"),$('[data-action="cllc.modal.close"]',$mobileFilterModal).off("click").on("click",function(){_filterModal.close(),DATALAYER.linkTrack(!0,{lpos:"search-new-inventory",lid:getMatchType+":filter-results-close",linkType:"tool",vars:{eVar5:contextVehicle,prop1:contextVehicle}})}),DATALAYER.linkTrack(!0,{lpos:"search-new-inventory",lid:getMatchType+":filter-results",linkType:"tool",vars:{eVar5:contextVehicle,prop1:contextVehicle}})},_showBmoMatchCriteria=function(event){var contextVehicle=cllc.context.get("vehicle");event.preventDefault(),cllc.session.get("sniInventoryFilters")&&(window.WdgtBMOCriteria?WdgtBMOCriteria.render():cllc.lazy.loadContent(document.getElementById("bmo_criteria")),DATALAYER.linkTrack(!0,{lpos:"search-new-inventory",lid:"build-criteria",linkType:"tool",vars:{eVar5:contextVehicle,prop1:contextVehicle}}))},_showCabBoxModal=function(event){var $this=$(this),contextVehicle=cllc.context.get("vehicle");event.preventDefault(),window.WdgtCabBoxModal?WdgtCabBoxModal.renderExploreCabBox():cllc.lazy.loadContent(document.getElementById("cab_box_modal")),DATALAYER.linkTrack(!0,{lpos:$this.attr("data-lpos"),lid:$this.attr("data-lid"),linkType:"tool",vars:{eVar5:contextVehicle,prop1:contextVehicle}})},_backToTop=function(event){var contextVehicle=cllc.context.get("vehicle");event.preventDefault(),$("html, body").animate({scrollTop:0},400),DATALAYER.linkTrack(this,{lid:"back-to-top",lpos:"search-new-inventory",linkType:"tool",vars:{eVar5:contextVehicle,prop1:contextVehicle}})},_scrollOrTouchEventName=function(){var eventName="touchmove scroll";try{document.createEvent("TouchEvent"),document.body.className+=" touch-device"}catch(e){eventName="scroll"}return eventName}();return"sni-search-results"===(page=SNI.page)?("bmo"===SNI.params.ref&&(onCVDDataInitialized=function(){$(".xb-app-header").find(".bmo-matches").show()},cllc.context.get().cvdDataInitialized?onCVDDataInitialized():cllc.context.addListener("cvdDataInitialized",onCVDDataInitialized),$(".build-criteria").on("click",_showBmoMatchCriteria)),$(".filter-results").on("touchend click",function(e){e.preventDefault(),$filterContainerWdgtContainer.attr("data-uri")?cllc.lazy.loadContent($filterContainerWdgtContainer.get(0),function(){_showMobileFilterModal()}):_showMobileFilterModal()}),$(document).on("click",'a[href="#cab-box-modal"]',_showCabBoxModal),$(document).on("click",'a[href="#back-to-top"]',_backToTop),$(window).scroll(function(){var _top=$(this).scrollTop(),_results=$(".results").offset().top+$(".results").height(),_backToTop=$(".backtotop").offset().top;_top>$(".results").offset().top+200&&_backToTop<=_results?$(".backtotop").css("display","block").addClass("showResults"):$(".backtotop").css("display","none").removeClass("showResults")}),$(window).on("scroll",function(){var _bottomPos=$(this).scrollTop()+$(this).height(),$filterButton=$("a.filter-results"),$results=$(".results-container");$results.offset().top+$results.height()<=_bottomPos?$filterButton.addClass("static"):$filterButton.removeClass("static")}),$(window).on(_scrollOrTouchEventName+" resize",function(){_isGreaterThan767=!!fnMatchMedia("(min-width: 768px)").matches}),$(window).on(_scrollOrTouchEventName+" resize",function(){var sniSearchResultsLength=$('div[data-page-template="sni-search-results"]').length;_isGreaterThan767&&sniSearchResultsLength&&_fixFilterPosition(_fixFilterPositionOptionsDefault)}),$(window).on("resize",function(){_isGreaterThan767&&_filterModal&&_filterModal.close()}),cllc.events.addListener(document,"wdgtInventoryFilterOnChange",function(){return _currentScrollYPosition=0,window.scrollTo(0,0)}),$(window).load(function(){void 0===window.wdgtInventoryFilter&&cllc.lazy.loadContent($filterContainerWdgtContainer.get(0))})):"sni-vehicle-details"===page&&$('a[href="#back"]').on("click",_backToResults),$(document).on("click",'a[href="#pe-overlay"]',_peModal),$(document).on("click",'a[href="#gaq-overlay"]',_gaqModal),{hideFilterModal:function(){_filterModal&&_filterModal.close()},showFilterModal:_showMobileFilterModal}}(jQuery);