cllc.context.get("zipcode")?DATALAYER.set({pageName:"payment-calculator"}):DATALAYER.set({pageName:"payment-calculator:get-started"});var pickerPage=function(){"alfaromeousa"===cllc.context.get("brand")?window.location.replace("vehicle-selector.pe?app=pe"):window.location.replace("vehicle-selector.pe.html?app=pe")};PE.BusinessLogic=new function(){var _cvdData=void 0,_cvdFilterGroupsToDisplay=[],_filterGroupsConfig=[],_filtersConfigTrimFilter,_matchingModelWithTrims,_matchingTrimValue,_modelWithTrimsCollection=[],_trimFilterGroup,_runServices=function(){var vin=cllc.request.queryString.vin;cllc.context.get("zipcode")&&("false"===PE.printView?($(".vehicle-selection-container").addClass("vehicle-chosen"),PE.DataAccess.getVehicleOffers(function(offerData){PE.UIController.Markup.BuyLeaseColumns.render(offerData)},vin)):PE.DataAccess.getVehicleOffers(function(offerData){PE.UIController.Markup.BuyLeaseColumnsPrint.render(offerData)},vin)),$(".xb-app-pc-content.xb-app-column-content").show(),PE.UIController.updateGlobalContent(),"undefined"!=typeof setFormValues&&0===$("#eshop-banner").length&&setFormValues(cllc.context.get())},_initCVDData=function(args){var callback=args.callback,modelYearCode=args.modelYearCode;"undefined"!=typeof CVDApi?!_cvdData&&modelYearCode&&CVDApi.fetchCVDData({modelYearCode:modelYearCode}).then(function(result){result instanceof Error||(_cvdData=result),callback()}).catch(function(ex){console.error(ex),callback()}):callback()},_getFilterGroupsConfigTrimFilter=function(){return _filtersConfigTrimFilter=(STConfig&&STConfig.filters||{}).trimFilter||""},_getFilterGroupsConfig=function(args){var modelYearCode=args.modelYearCode,filtersConfig=STConfig&&STConfig.filters||{},returnValue=(filtersConfig.overrideFilters||{})[modelYearCode]||filtersConfig.defaultFilters||[];return Array.isArray(returnValue)?(_filterGroupsConfig=returnValue.slice(0)).slice(0):[]},_getFilterGroupsToDisplay=function(args){var modelYearCode=args.modelYearCode,modelWithTrims=args.modelWithTrims,validFilterGroups=[],cvdFilterGroupsToDisplay=[],filterGroupsConfig=_getFilterGroupsConfig({modelYearCode:modelYearCode}),filterGroupsConfigTrimFilter=_getFilterGroupsConfigTrimFilter(),trimFilterGroup=_cvdData.filterGroups.find(function(v){return(v.descriptionId||"").toString().toLowerCase()===(filterGroupsConfigTrimFilter.description||"").toString().toLowerCase()}),inputFilterGroupsToDisplayArr=filterGroupsConfig.map(function(v){return(v.description||"").toString().toLowerCase()});return validFilterGroups=modelWithTrims.validFilterGroups,(cvdFilterGroupsToDisplay=inputFilterGroupsToDisplayArr.length?validFilterGroups.filter(function(v){return 0<=inputFilterGroupsToDisplayArr.indexOf((v.descriptionId||"").toString().toLowerCase())}):[]).sort(function(v1,v2){return inputFilterGroupsToDisplayArr.indexOf((v1.descriptionId||"").toString().toLowerCase())-inputFilterGroupsToDisplayArr.indexOf((v2.descriptionId||"").toString().toLowerCase())}),cvdFilterGroupsToDisplay.unshift(trimFilterGroup),{cvdFilterGroupsToDisplay:cvdFilterGroupsToDisplay,trimFilterGroup:trimFilterGroup}},_initCVDFilterGroupsToDisplay=function(args){var ccode=args.ccode,modelYearCode=args.modelYearCode;if(_cvdData){var modelWithTrimsCollection=_modelWithTrimsCollection=_cvdData.getModelWithTrimsCollection(),matchingModelWithTrims=_matchingModelWithTrims=modelWithTrimsCollection.find(function(v){return v.trimCollection.find(function(v2){return v2.ccode===ccode})})||modelWithTrimsCollection[0],filterGroupsToDisplay=_getFilterGroupsToDisplay({modelYearCode:modelYearCode,modelWithTrims:matchingModelWithTrims});_matchingTrimValue=matchingModelWithTrims.trimCollection.find(function(v){return v.ccode===ccode})||matchingModelWithTrims.trimCollection[0],_trimFilterGroup=filterGroupsToDisplay.trimFilterGroup,_cvdFilterGroupsToDisplay=filterGroupsToDisplay.cvdFilterGroupsToDisplay.slice(0)}else _cvdFilterGroupsToDisplay=[]},_initPageCallback=function(){PE.userDownPayment=!1,cllc.context.set("no_conflict",!0),cllc.context.set("active_tab","buy"),PE.isOfferState&&"bmo"===PE.callingApp?($(".footer-nav .standard-view").css("display","none"),$(".xb-app-pc-content .bmo-view-a").css("display","block"),$(".xb-app-pc-content .finance-options").addClass("gc-button-secondary")):PE.isOfferState&&"sni"===PE.callingApp&&$(".footer-nav .standard-view").css("display","none"),DATALAYER.set({year:cllc.context.get("year"),vehicle:cllc.context.get("vehicle")}),cllc.context.addListener("trim",function(oldTrim,newTrim){newTrim&&(digitalData.page.pageInfo.vehicleTrim=cllc.context.get("trim").replace(/_/g,"-"))}),cllc.context.addListener("model",function(prevVal,nextVal){nextVal&&_runServices.call(this)}),cllc.context.addListener("discounts",function(oldDiscount,newDiscount){var dbool=Number(newDiscount)>=Number(PE.vehicle.vehiclePrice)?"true":"false";cllc.context.set("no_conflict",dbool)}),cllc.context.addListener("no_conflict",function(oldVal,newVal){cllc.context.get("active_tab");"true"===newVal?($(".column-row.row-four .edit-fields").addClass("conflict"),$(".column-row.row-four .conflict_message").css("display","block"),PE.BusinessLogic.adjustWindow()):($(".column-row.row-four .edit-fields").removeClass("conflict"),"false"==PE.printView&&($(".column-row.row-four .conflict_message").css("display","none"),PE.BusinessLogic.adjustWindow()))}),cllc.context.addListener("active_tab",function(oldTab,newTab){if(void 0!==newTab){var oldtab="."+oldTab+"-column",newtab="."+newTab+"-column";$(oldtab).removeClass("gc-border-color-a"),$(oldtab).removeClass("border-top-thick"),$(oldtab).addClass("border-top-thin"),$(newtab).addClass("gc-border-color-a"),$(newtab).removeClass("border-top-thin"),$(newtab).addClass("border-top-thick")}}),cllc.context.addListener("buy_term",function(oldTerm,newTerm){PE.BusinessLogic.monthlyPayment({id:"term",value:newTerm,type:"buy"},{id:"rate",value:cllc.context.get("buy_rate"),type:"buy"}),PE.UIController.Markup.UpdateStandardAPR.render()}),cllc.context.addListener("lease_term",function(oldTerm,newTerm){PE.offerData.lease.term=newTerm,PE.offerData.lease.rate=cllc.context.get("lease_rate"),PE.UIController.Markup.MileageSelectBox.render(PE.offerData.lease.terms,"lease",newTerm)}),cllc.context.addListener("mileage",function(oldMileage,newMileage){PE.offerData.lease.mileage=newMileage}),cllc.context.addListener("residual",function(oldResidual,newResidual){PE.BusinessLogic.monthlyPayment({id:"residual",value:newResidual,type:"lease"})}),cllc.context.addListener("rate_value",function(oldRateValue,newRateValue){PE.offerData.buy.rate=newRateValue,"radio_user_rate"===cllc.context.get("rate_type")&&(PE.offerData.buy.user_rate=newRateValue,$("#radio_user_rate").prop("value",newRateValue).attr("value",newRateValue)),PE.BusinessLogic.monthlyPayment({id:"rate",value:newRateValue,type:"buy"}),PE.UIController.Markup.BuyLeaseColumns.render(PE.offerData)}),cllc.context.addListener("rate_type",function(oldRateType,newRateType){if("radio_user_rate"===newRateType){var chryslerOfferType=cllc.context.get("offer_type")||"custom_apr";cllc.context.set("chryslerOfferType",chryslerOfferType),PE.offerData.buy.offerType="custom_apr",$("#"+newRateType).prop("checked",!0)}else PE.offerData.buy.offerType=cllc.context.get("chryslerOfferType")}),cllc.context.addListener("zipcode",function(oldZip,newZip){var vin=cllc.request.queryString.vin;"undefined"!==newZip&&void 0!==cllc.context.get("model")&&oldZip!==newZip&&("false"===PE.printView?PE.DataAccess.getVehicleOffers(function(offerData){PE.UIController.Markup.BuyLeaseColumns.render(offerData)},vin):PE.DataAccess.getVehicleOffers(function(offerData){PE.UIController.Markup.BuyLeaseColumnsPrint.render(offerData)},vin))}),cllc.events.addListener(document,"click","a[href^='#pe-app-']",function(event){event.preventDefault();var app=this.getAttribute("href").replace("#pe-app-","").trim(),context=this.getAttribute("data-context");(context=String.isNullOrWhiteSpace(context)?cllc.context.get():JSON.parse(context)).year&&context.vehicle&&context.trim?(context.ccode=Vehicles.getCcode(context),context.llp=Vehicles.getLLP(context)):context.year&&context.vehicle&&(context.modelYearCode=Vehicles.getModelYearCode(context));var appPath="/crossbrand_us/common/bridge/"+cllc.config.brand+"/bridge.html?app="+app,a=cllc.utils.parseQueryString(context);String.isNullOrWhiteSpace(a)||(appPath+="&"+a),"bmo"===app?PE.BusinessLogic.applyPayment(!1,appPath):window.top.location.href=appPath}),void 0!==cllc.context.get("model")&&_runServices.call(this)},_initPage=function(){var modelYearCode=cllc.request.queryString.modelYearCode||cllc.context.get().modelYearCode||Vehicles.getModelYearCode(cllc.context.get()),ccode=cllc.request.queryString.ccode||cllc.context.get().ccode||Vehicles.getCcode(cllc.context.get());_initCVDData({modelYearCode:modelYearCode,callback:function(){_initCVDFilterGroupsToDisplay({ccode:ccode,modelYearCode:modelYearCode}),_initPageCallback(),PE.UIController.Markup.FilterGroups.render({cvdFilterGroupsToDisplay:_cvdFilterGroupsToDisplay,filterGroupsConfig:_filterGroupsConfig,filtersConfigTrimFilter:_filtersConfigTrimFilter,getFilterGroupsToDisplay:_getFilterGroupsToDisplay,modelWithTrims:_matchingModelWithTrims,modelWithTrimsCollection:_modelWithTrimsCollection,modelYearCode:modelYearCode,trim:_matchingTrimValue,trimFilterGroup:_trimFilterGroup})}})},_initContext=function(){var myc=cllc.request.queryString.modelYearCode,ccode=cllc.request.queryString.ccode,year=cllc.request.queryString.year,vehicle=cllc.request.queryString.vehicle||cllc.request.queryString.family,model=cllc.request.queryString.model,trim=cllc.request.queryString.trim,variation="";if(ccode||myc||year||vehicle||(myc=shoppingTools.getVehicleSelectorMYC()),year&&vehicle&&!ccode){var context={year:year,vehicle:vehicle},vehicleActiveYearsLength=Vehicles.active_years.length,flag=!0;trim&&(context.trim=trim),model&&(context.model=model);for(var i=0;i<vehicleActiveYearsLength;i++){if(context.year===Vehicles.active_years[i]){flag=!0;break}flag=!1}if(!0===flag)ccode=Vehicles.getCcode(context);else{var hrefUrl=-1!==window.location.hostname.indexOf("alfaromeousa")?"/vehicle-selector.pe?app=pe":"/vehicle-selector.pe.html?app=pe";window.location.href=hrefUrl}}for(var availableYears=Vehicles.getAvailableYears().sort(function(a,b){return a-b}),availableVehicles={},y=0;y<availableYears.length;y++){var years=parseFloat(availableYears[y]);availableVehicles[availableYears[y]]=Vehicles.getAvailableVehicles({year:years})}var availableCabs,availableSeating,canGetSeating="function"==typeof Vehicles.getAvailableSeatings;if(ccode)try{myc=ccode.substring(0,9),cllc.context.set("year",ccode.substring(3,7)),cllc.context.set("availableVehicles",availableVehicles),cllc.context.set("vehicle",Vehicles.getFamilyFromMYC(myc)),cllc.context.set("availableTrims",Vehicles.getAvailableTrims(cllc.context.get())),cllc.context.set("trim",Vehicles.getTrimFromCcode(ccode)),cllc.context.set("availableDrives",Vehicles.getAvailableDrives(cllc.context.get())),cllc.context.set("model",Vehicles.getModelFromCcode(ccode)),variation=Vehicles.getVariation(cllc.context.get()).split("-"),cllc.context.set("drive",window.parseInt(variation[0])),1<variation.length&&(cllc.context.remove("model"),availableCabs=Vehicles.getAvailableCabs(cllc.context.get()),availableSeating=canGetSeating?Vehicles.getAvailableSeatings(cllc.context.get()):[],cllc.context.set("availableCabs",availableCabs),canGetSeating&&cllc.context.set("availableSeating",availableSeating),cllc.context.set("model",Vehicles.getModelFromCcode(ccode)),availableCabs.length?cllc.context.set("cab",window.parseInt(variation[1])):availableSeating.length&&cllc.context.set("seating",window.parseInt(variation[1]))),cllc.context.set("model",Vehicles.getModelFromCcode(ccode)),PE.isOfferState||"true"===PE.printView?$(".xb-app-pe-util-nav ul.vehicle-select-box-container").hide():(PE.UIController.Markup.TrimSelectBox.render(),PE.UIController.Markup.DriveSelectBox.render(),Vehicles.getAvailableCabs(cllc.context.get()).length&&PE.UIController.Markup.CabSelectBox.render(),canGetSeating&&Vehicles.getAvailableSeatings(cllc.context.get()).length&&PE.UIController.Markup.SeatingSelectBox.render()),PE.UIController.Markup.StaticVehicleLabel.render(),_initPage.call(this)}catch(ex){ccode=null,pickerPage()}else if(myc)try{cllc.context.set("year",myc.substring(3,7)),cllc.context.set("availableVehicles",availableVehicles),cllc.context.set("vehicle",Vehicles.getFamilyFromMYC(myc)),cllc.context.set("availableTrims",Vehicles.getAvailableTrims(cllc.context.get())),cllc.context.set("trim",Vehicles.getTrimFromCcode(Vehicles.getCcode(cllc.context.get()))),cllc.context.set("availableDrives",Vehicles.getAvailableDrives(cllc.context.get())),cllc.context.set("model",Vehicles.getBaseModel(cllc.context.get())),variation=Vehicles.getVariation(cllc.context.get()).split("-"),cllc.context.set("drive",window.parseInt(variation[0])),1<variation.length&&(cllc.context.remove("model"),availableCabs=Vehicles.getAvailableCabs(cllc.context.get()),availableSeating=canGetSeating?Vehicles.getAvailableSeatings(cllc.context.get()):[],cllc.context.set("availableCabs",availableCabs),canGetSeating&&cllc.context.set("availableSeating",availableSeating),cllc.context.set("model",Vehicles.getBaseModel(cllc.context.get())),availableCabs.length?cllc.context.set("cab",window.parseInt(variation[1])):availableSeating.length&&cllc.context.set("seating",window.parseInt(variation[1]))),cllc.context.set("model",Vehicles.getModelFromCcode(Vehicles.getCcode(cllc.context.get()))),PE.UIController.Markup.TrimSelectBox.render(),PE.UIController.Markup.DriveSelectBox.render(),Vehicles.getAvailableCabs(cllc.context.get()).length&&PE.UIController.Markup.CabSelectBox.render(),canGetSeating&&Vehicles.getAvailableSeatings(cllc.context.get()).length&&PE.UIController.Markup.SeatingSelectBox.render(),_initPage.call(this),pickerPage()}catch(ex){myc=null,pickerPage()}else try{cllc.context.set("availableVehicles",availableVehicles),_initPage.call(this)}catch(ex){}},_init=function(){var callingApp=cllc.request.queryString.calling_app,vin=cllc.request.queryString.vin,dealerid=cllc.request.queryString.dealerid,zipcode=cllc.request.queryString.zipcode,offerStateCookie="";if(PE.printView=cllc.request.queryString.is_print||"false",offerStateCookie="false"===PE.printView?cllc.request.cookies.offerState:cllc.request.cookies.printState,PE.isDebug=!(!cllc.request.queryString.isDebug||"true"!==cllc.request.queryString.isDebug),"true"===PE.printView&&($("link[href*='global.css'][media*='screen']").removeAttr("media"),$(".xb-app-content .xb-app-pe-util-nav.zipcode .zipcode-container div > div:not(.gc-forms-textbox)").css("display","none")),$("#xb-main-content-wrapper").addClass(Vehicles.brand),PE.offerStateValue=!!offerStateCookie&&eval("("+offerStateCookie.value+")"),callingApp&&cllc.context.set("callingApp",callingApp),PE.isOfferState=!!(PE.offerStateValue&&callingApp||PE.offerStateValue&&"true"===PE.printView),PE.brand=Vehicles.getBrand()||cllc.config.brand,PE.vinPrint=vin?"&vin="+vin:"",PE.vin=vin?"VIN: "+vin:0,PE.callingApp=callingApp||"undefined",PE.CreditBrand="ramtrucks"===PE.brand?"ram":"fiatusa"===PE.brand?"fiat":PE.brand,PE.UTMCampaign={ramtrucks:"312",dodge:"305",jeep:"311",chrysler:"310",fiatusa:"313"},PE.chosenRate=0,vin&&cllc.context.set("vin",vin),zipcode&&cllc.context.get("zipcode")!==zipcode&&cllc.context.set("zipcode",zipcode),dealerid&&cllc.context.set("dealerid",dealerid),$("body").hasClass("lt-ie9")&&$("#xb-main-content-wrapper .gc-forms-dropdown").removeClass("gc-forms-dropdown-custom"),PE.callingApp&&"sni"===PE.callingApp&&!Vehicles.inventory){var inventoryUrl="/data/inventory.js";jQuery.getScript(inventoryUrl,function(){_initContext.call(this)})}else _initContext.call(this)};this.totalOptionsCost=function(offerData){return parseFloat(offerData.configuredPrice)-parseFloat(offerData.basePrice)},this.totalCashIncentives=function(offerData){var n,i=0,val=0;if(!offerData)return val;for(n=offerData.length;i<n;i++)val=parseFloat(offerData[i].value)+val;return val},this.cashIncentives=function(offerData){var markup=[],dataTooltip="";return Array.isArray(offerData)&&1<=offerData.length&&("false"!==PE.printView&&(dataTooltip='data-tooltip-class="true"'),markup=offerData.map(function(data){var right='<div class="xb-app-cash-incentives-list gcss-typography-label-3 '+("undefined"!=typeof mGlobal?"":"left")+'">';right+='<div class="print-dash-lines"></div>',right+='<span class="cash-incentive-amount right '+("undefined"!=typeof mGlobal?"":"gc-font-size-smaller")+' gcss-typography-label-3">-$ '+data.value.format("#,#")+"</span>",right+="</div>";var left='<span class="left program-name"><span> '+data.programName;return left+='<sup class="tooltip" '+dataTooltip+' title="'+data.upicDisclaimer+'">+</sup>',{right:right,left:left+="</span></span>"}})),markup},this.estimateFinanceAmount=function(type,caller){PE.offerData[type].finance=Number(PE.vehicle.vehiclePrice)+Number(PE.vehicle.otherCapCosts)+parseFloat(PE.vehicle.destination)-Number(PE.offerData[type].cash)-Number(PE.downPayment)-Number(PE.offerData[type].tradeInValue)-Number(PE.offerData[type].dealerDiscount),PE.isDebug&&(console.log("estimateFinanceAmount : TYPE -> "+type+" | CALLER -> "+caller),console.log("vehiclePrice :   "+PE.vehicle.vehiclePrice),console.log("destination :    "+PE.vehicle.destination),console.log("otherCapCosts :  "+PE.vehicle.otherCapCosts),console.log("cash :           "+PE.offerData[type].cash),console.log("downPayment :    "+PE.downPayment),console.log("tradeInValue :   "+PE.offerData[type].tradeInValue),console.log("dealerDiscount : "+PE.offerData[type].dealerDiscount),console.log("term:            "+PE.offerData[type].term),console.log("chosenRate :    "+PE.chosenRate),console.log("------------------------------")),PE.UIController.Markup.UpdateFinanceEstimate.render(type)},this.monthlyPayment=function(){for(var args=arguments,financeParams={},p="",x=0;x<args.length;x++)if(void 0!==PE.offerData[args[x].type]){PE.offerData[args[x].type][args[x].id]=args[x].value,"buy"===args[x].type&&"radio_user_rate"===cllc.context.get("rate_type")?PE.chosenRate=Number(PE.offerData[args[x].type].user_rate):PE.chosenRate=Number(PE.offerData[args[x].type].rate),PE.callingApp&&"sni"===PE.callingApp?(financeParams.vehiclePrice=Number(PE.vehicle.vehiclePrice),financeParams.otherCapCosts=Number(PE.vehicle.otherCapCosts)):financeParams.vehiclePrice=Number(PE.vehicle.vehiclePrice)+Number(PE.vehicle.otherCapCosts),financeParams.rate=Number(PE.chosenRate),financeParams.term=Number(PE.offerData[args[0].type].term),financeParams.destination=Number(PE.vehicle.destination),financeParams.downPayment=Number(PE.downPayment),financeParams.tradeInValue=Number(PE.offerData[args[0].type].tradeInValue),financeParams.dealerDiscount=Number(PE.offerData[args[0].type].dealerDiscount),financeParams.incentives=Number(PE.offerData[args[x].type].cash);var discounts=financeParams.dealerDiscount+financeParams.tradeInValue+financeParams.downPayment+Number(PE.offerData[args[0].type].cash);cllc.context.set("discounts",discounts),!1!==cllc.context.get("no_conflict")&&("lease"===args[0].type?(financeParams.residual=Number(PE.offerData[args[0].type].residual),financeParams.mileage=Number(PE.offerData[args[0].type].mileage),p=net.autodata.chrysler.pe.PaymentCalculator.getLeasePayment(financeParams)):p=net.autodata.chrysler.pe.PaymentCalculator.getFinancePayment(financeParams),PE.offerData[args[0].type].payment=p.payment,PE.isDebug&&console.log("monthlyPayment : args[x].id : "+args[x].id),PE.BusinessLogic.estimateFinanceAmount(args[0].type,"monthlyPayment"),PE.UIController.Markup.UpdateMonthlyPayment.render(args[0].type))}},this.downPaymentPercent=function(dp,value){PE.downPaymentPercentActual=value/dp,PE.downPaymentPercent=Number(value/dp*100).toFixed(),PE.isDebug&&(console.log('PE["downPaymentPercentActual"] : '+PE.downPaymentPercentActual),console.log('PE["downPaymentPercent"] : '+PE.downPaymentPercent)),PE.UIController.Markup.UpdateDownPaymentPercent.render()},this.downPayment=function(value){var _otherCapCosts=isFinite(PE.vehicle.otherCapCosts)?Number(PE.vehicle.otherCapCosts):0,_val=PE.downPayment?-1!==value?Number(value):PE.downPayment:Number(value),_price=Number(PE.vehicle.vehiclePrice)+Number(PE.vehicle.destination)+_otherCapCosts,_per=PE.downPaymentPercentActual?PE.downPaymentPercentActual:Number(PE.downPaymentPercent);PE.callingApp&&"sni"===PE.callingApp&&(_price=Number(PE.vehicle.configuredPrice)),-1!==value&&(PE.BusinessLogic.downPaymentPercent(_price,_val),_per=PE.downPaymentPercentActual.valueOf()),PE.userDownPayment&&-1===value?PE.BusinessLogic.downPaymentPercent(_price,PE.downPayment):PE.downPayment=Math.ceil(_price*_per)},this.getLeaseResidualTerms=function(incentives,term,incid){for(var resArr=[],resFilter=incentives[parseFloat(incid)-1].terms.filter(function(a){return a.duration==term}),r=0,n=resFilter.length;r<n;r++)resArr[r]={residual:resFilter[r].value,mileage:resFilter[r].mileage};return resArr},this.getLeaseTerms=function(offerData,incentives){for(var data=[],d=0,n=(offerData=offerData.slice(0).sort(function(a,b){return b.duration-a.duration})).length;d<n;d++){var term=offerData[d].duration,rate=offerData[d].offer.rateIncentive.rate,termtype=offerData[d].offer.type,residual=offerData[d].offer.residualIncentive.rate,mileage=offerData[d].offer.residualIncentive.mileage,residuals=PE.BusinessLogic.getLeaseResidualTerms(incentives,term,offerData[d].offer.residualIncentive.incid);data[d]={term:term,rate:rate,residual:residual,mileage:mileage,residuals:residuals,termtype:termtype}}return data},this.getBuyTerms=function(offerData){for(var data=[],d=0,n=(offerData=offerData.slice(0).sort(function(a,b){return b.duration-a.duration})).length;d<n;d++){var term=offerData[d].duration,rate=offerData[d].offer.rateIncentive.rate,termtype=offerData[d].offer.type;data[d]={term:term,rate:rate,termtype:termtype}}return data},this.cleanNum=function(value){return parseFloat(value.replace(/,|\$/gi,""))},this.validateZipCode=function(value){return/^\d{5}$/.test(value)},this.applyPayment=function(isPrint,path){try{!PE.offerStateValue&&(PE.offerStateValue={});var bType="";bType="custom_apr"===PE.offerData.buy.offerType||"cash_allowance"===PE.offerData.buy.offerType?5<=PE.offerData.buy.cash?"cash_allowance":"custom_apr":PE.offerData.buy.offerType,PE.offerStateValue.buyOfferType=bType,PE.offerStateValue.buyRate="radio_user_rate"===cllc.context.get("rate_type")?Number(PE.offerData.buy.user_rate):PE.chosenRate=Number(PE.offerData.buy.rate),PE.offerStateValue.buyRateType=cllc.context.get("rate_type"),PE.offerStateValue.buyTerm=Number(PE.offerData.buy.term),PE.offerStateValue.downPayment=PE.downPayment,PE.offerStateValue.downPaymentOverride=PE.downPaymentOverride,PE.offerStateValue.downPaymentPercentActual=Number(PE.downPaymentPercentActual),PE.offerStateValue.downPayPercent=Number(PE.downPaymentPercent),PE.offerStateValue.tradeInValue=Number(PE.offerData.buy.tradeInValue),PE.offerStateValue.dealerDiscount=Number(PE.offerData.buy.dealerDiscount),PE.offerStateValue.buyMonthlyPayment=Number(PE.offerData.buy.payment),void 0!==PE.offerData.lease&&(PE.offerStateValue.leaseOfferType=PE.offerData.lease.offerType,PE.offerStateValue.leaseRate=Number(PE.offerData.lease.rate),PE.offerStateValue.leaseTerm=Number(PE.offerData.lease.term),PE.offerStateValue.mileage=Number(PE.offerData.lease.mileage),PE.offerStateValue.residual=Number(PE.offerData.lease.residual),PE.offerStateValue.leaseMonthlyPayment=Number(PE.offerData.lease.payment)),isPrint?(Cookie.set("printState",JSON.stringify(PE.offerStateValue),{path:"/",duration:!1}),document.cookie="offerState=;expires=Thu, 01-Jan-1970 00:00:01 GMT;path=/;host="+window.location.host+";false",PE.BusinessLogic.setUpPrint()):(String.isNullOrWhiteSpace(path)||(PE.offerStateValue.downPaymentOverride=!0),Cookie.set("offerState",JSON.stringify(PE.offerStateValue),{path:"/",duration:!1}),document.cookie="printState=;expires=Thu, 01-Jan-1970 00:00:01 GMT;path=/;host="+window.location.host+";false",String.isNullOrWhiteSpace(path)?(void 0!==window.top.com.chrysler&&window.top.com.chrysler.bmo.refreshSelectedOffer(),$(window.top.document).find(".cllc-modal-button").trigger("click")):setTimeout(function(){window.top.location.href=path},200))}catch(e){PE.isDebug&&console.log(e)}},this.adjustWindow=function(){if(PE.isDebug&&(console.log("adjustWindow"),console.log(window.parent.peframe),console.log(window.frameElement),console.log("-----------------")),null!==window.frameElement){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height=parseFloat(height+15),$(window.top.document).find("#pe-modal-1 iframe").css({height:height}),$(window.top.document).find("#pe-modal-1").css({height:height})}},this.setUpPrint=function(){var callingAppPrint="undefined"!==PE.callingApp?"&calling_app="+PE.callingApp:"",printQuery="https://"+document.location.host,ccode=Vehicles.getCcode(cllc.context.get()),veh=null,yr=null;if(ccode){var myc=ccode.substr(0,9);try{veh=Vehicles.getFamilyFromMYC(myc),yr=myc.substr(3,4)}catch(e){}}-1!==window.location.hostname.indexOf("alfaromeousa")?(printQuery+="/payment-calculator",veh&&yr&&(printQuery+="."+veh+"."+yr)):veh&&yr?printQuery="/payment-calculator."+veh+"."+yr+".html":printQuery+="/payment-calculator.html",printQuery+="?zipcode="+cllc.context.get("zipcode")+"&ccode="+Vehicles.getCcode(cllc.context.get())+PE.vinPrint+"&is_print=true&isOverlay=true&disable_ssl_redirect=true"+callingAppPrint,window.top.open(printQuery,"_blank")},this.toString=function(){return"[object PE.BusinessLogic]"},window.addEventListener("load",function(){_init.call(this)},!1)};